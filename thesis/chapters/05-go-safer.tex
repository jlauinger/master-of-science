%% ---------------------------------------------------------------------------------------------------------------------

\chapter{\textit{go-safer}: Detecting Unsafe Misuses}\label{ch:go-safer}

Another major contribution of this thesis is the development of \toolSafer{}, a \toolVet{}-style, open-source linter
tool with a focus on the \unsafe{} \acrshort{API} in Go.
It can identify some of the unsafe code patterns described in Chapter~\ref{ch:unsafe-security-problems} and thus help
developers to write safer code.
This chapter describes the design and implementation of \toolSafer{}, as well as an evaluation of its effectiveness both
using the labeled data set of \unsafe{} usages presented in the previous chapter and a manual analysis of \checkNum{six}
open-source Go packages.

\input{assets/figures/chapter5/outline5.tex}


%% ---------------------------------------------------------------------------------------------------------------------

\section{Design}\label{sec:go-safer:design}

The \toolSafer{} static analysis tool is designed as a linter to detect two misuses of the \unsafe{} \acrshort{API}.
The first is the incorrect conversion pattern between slices and strings by creating their header structures as
composite literals as described in Sections~\ref{subsec:unsafe-security-problems:slice-casts:gc-race}
and~\ref{subsec:unsafe-security-problems:slice-casts:escape-analysis}.
The second is a direct conversion between struct types containing incompatible types with architecture-dependent sizes.
The source code and documentation of \toolSafer{} is available on
\github{}\footnote{\url{https://github.com/jlauinger/go-safer}}.

\input{assets/listings/chapter5/go-safer-sliceheader-pass.tex}

\input{assets/listings/chapter5/go-safer-structcast-pass.tex}

Usage: \textit{go-safer ./my/package}

\input{assets/images/chapter5/go-safer-screenshot.tex}


%% ---------------------------------------------------------------------------------------------------------------------

\section{Implementation}\label{sec:go-safer:implementation}

\input{assets/figures/chapter5/go-safer-architecture.tex}

Go vet analysis pass infrastructure
Low-level details
Verification with tests


%% ---------------------------------------------------------------------------------------------------------------------

\section{Evaluation}\label{sec:go-safer:evaluation}


%% ---------------------------------------------------------------------------------------------------------------------

\subsection{Labeled Usages}\label{subsec:go-safer:evaluation:labeled-usages}

Precision, Recall, calculated using manually labeled usages data set

\input{assets/tables/chapter5/go-safer-evaluation-dataset.tex}


%% ---------------------------------------------------------------------------------------------------------------------

\subsection{Case Studies}\label{subsec:go-safer:evaluation:case-studies}

Manual inspection of some projects, used to calculate precision / recall of go-safer

\input{assets/tables/chapter5/go-safer-evaluation-packages.tex}


%% ---------------------------------------------------------------------------------------------------------------------

\subsection{Comparison with Existing Tools}\label{subsec:go-safer:evaluation:linters-comparison}

Go vet / Gosec
